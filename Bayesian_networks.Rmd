---
title: "Bayesian Networks"
author: "Wu Gong"
date: "`r Sys.Date()`"
output:
  rmdformats::readthedown:
    self_contained: true
    thumbnails: false
    code_folding: hide
    toc_depth: 6
    lightbox: true
    gallery: false
    highlight: monochrome
    css: Wu.css
---


	
```{r setup, echo=FALSE, cache=FALSE,warning=FALSE,message=FALSE}
library(knitr)
library(rmdformats)
library(Wu)
opts_chunk$set(echo=TRUE
             , cache=FALSE
             , eval=TRUE
             , prompt=FALSE
             , results="asis"
             , tidy=FALSE
             , comment=NA
             , message=FALSE
             , warning=FALSE
             , out.width = '80%'
             , class.source='klippy'
               )
eval_fast <- TRUE
eval_slow <- FALSE
klippy::klippy(position = c('top', 'left')
             , tooltip_message = 'Click to copy'
             , tooltip_success = 'Done')
```




# [Back to Index](index.html)



# Gaussian Graphical Model



## GGMselect


```{r}
library("GGMselect")


data("asia", package = "bnlearn")
colnames(asia) <- c("Asia", "Smoking"
                  , "Tuberculosis", "LungCancer"
                  , "Bronchitis", "Either"
                  , "XRay", "Dyspnea")
dt <- as.data.table(asia)
cols <- colnames(dt)
dtn <- dt[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]


mtx <- data.matrix(dtn)

g <- selectFast(mtx, family = "C01", K = 0.1)


library(network)

plot(g$C01$G)

```

## Partial Correlation

```{r}
library(corpcor)

rp <- cor2pcor(cor(dtn, method = "spearman"))

library(igraph)

g <- graph.adjacency(abs(rp) > 0.1, mode = "undirected", diag = FALSE)

plot(g, vertex.label = colnames(dt))

```


## ggm: Construct and Visualize Gaussian Graphical Models

```{r}
library(Questools)

data("NHANES")
## Using raw data
## No need to choose the continuous variables (They will be detected automatically)
glasso_ggm <- ggm(data = NHANES[1:1000, ], methods = c("glasso"), levels = 15)

```


# R abn Package

 * [abn: Modelling Multivariate Data with Additive Bayesian Networks](https://cran.r-project.org/web/packages/abn/index.html)

## Data

```{r}

library(abn)
library(Rgraphviz)

data("asia", package = "bnlearn")
colnames(asia) <- c("Asia", "Smoking"
                  , "Tuberculosis", "LungCancer"
                  , "Bronchitis", "Either"
                  , "XRay", "Dyspnea")
DT(asia)

```

## Relationship of the Variables


```{r}
distrib <- as.list(rep("binomial", 8))
names(distrib) <- names(asia)

mycache <- buildscorecache(data.df = asia, data.dist = distrib, max.parents = 4)

mp.dag <- mostprobable(score.cache = mycache)

fabn <- fitabn(object = mp.dag, create.graph = TRUE)
plot(fabn$abnDag)

```


# R bnlearn Package


 * [Marco Scutari: Learning Bayesian Networks with the bnlearn R Package](https://arxiv.org/pdf/0908.3817.pdf)


## Data

```{r}
library(bnlearn)
data("asia", package = "bnlearn")
colnames(asia) <- c("Asia", "Smoking"
                  , "Tuberculosis", "LungCancer"
                  , "Bronchitis", "Either"
                  , "XRay", "Dyspnea")


dt <- as.data.table(asia)

```


## Grow-Shrink Algorithm


 * Constraint-based algorithm for structure learning
 * Based on the Grow-Shrink Markov Blanket

```{r}
bn.gs <- gs(dt)

bn.gs

plot(bn.gs)

## dag <- empty.graph(names(dt))
## graphviz.plot(dag, highlight = list(arcs = arcs(bn.gs)))


bg05 <- gs(dt, alpha = 0.01)
bg10 <- gs(dt, alpha = 0.05)
bg20 <- gs(dt, alpha = 0.3)

par(mfrow = c(1, 3))
plot(bg05)
plot(bg10)
plot(bg20)


bn.gs2 <- gs(dt, debug = TRUE, alpha = 0.2)

plot(bn.gs2)

```


## IAMB 

 * Constraint-based algorithm
 * Based on the Increamental Association Markov Blanket (IAMB)


```{r}

bn.iamb <- iamb(dt)

plot(bn.iamb, main = "IAMB", highlight = c("Smoking", "Bronchitis"))

bn.iamb$arcs %>% prt()


modelstring(bn.iamb)


bb05 <- iamb(dt, alpha = 0.05)
bb10 <- iamb(dt, alpha = 0.3)
bb20 <- iamb(dt, alpha = 0.5)

par(mfrow = c(1, 3))
plot(bb05)
plot(bb10)
plot(bb20)

```


## Hill-Climbing (HC) Greed Search

 * Score-based algorithm


```{r}
bn.hc <- hc(dt, score = "aic")
plot(bn.hc)

```


# pcalg package


 * Ref: [An Overview of the pcalg Package for R](chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/https://cran.r-project.org/web/packages/pcalg/vignettes/vignette2018.pdf)

## PC Algorithm


```{r}
library(pcalg)
library(Rgraphviz)

cols <- colnames(dt)
dtn <- dt[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
n <- nrow(dtn)
V <- colnames(dtn)


pc.fit <- pc(suffStat = list(C = cor(dtn), n = n)
           , indepTest = gaussCItest
           , alpha = 0.05
           , labels = V
           , verbose = TRUE
             )


plot(pc.fit, main = "Estimated CPDAG")



```

## FCI Algorithm


```{r}

fci.fit <- fci(suffStat = list(C = cor(dtn), n = n)
           , indepTest = gaussCItest
           , alpha = 0.02
           , labels = V
           , verbose = TRUE
             )


plot(fci.fit, main = "Estimated FCI-PAG")

```


# R sessionInfo

```{r}
sessionInfo()

```
